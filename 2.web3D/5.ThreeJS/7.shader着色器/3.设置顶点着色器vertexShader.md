# 设置顶点着色器vertexShader

## 概述

+ `ShaderMaterial` 顶点着色器属性 `vertexShader` 的值是字符串，字符串的内容是着色器GLSL ES语言写的代码

  ```js
  const material = new THREE.ShaderMaterial({
    vertexShader: '',// 顶点着色器
  });
  ```

+ 为了方便预览顶点着色器代码，咱们用模板字符串 ` `的形式去写

  ```js
  const vertexShader = `
    // 写顶点着色器的代码
  `

  const material = new THREE.ShaderMaterial({
    vertexShader: vertexShader,// 顶点着色器
  });
  ```

## 设置顶点着色器主函数

+ 先按照着色器GLSL ES语言的语法，给顶点着色器代码设置一个主函数 `main`
+ 函数 `main` 无返回值，前面加上关键字 `void` 即可

  ```js
  const vertexShader = `
    void main(){
      // 写顶点着色器的代码
    }
  `

  const material = new THREE.ShaderMaterial({
    vertexShader: vertexShader,// 顶点着色器
  });
  ```

## 内置变量gl_Position

+ `gl_Position` 是着色器GLSL ES语言的内置变量，所谓内置变量，就是不用声明，就可以在代码中使用

+ 着色器内置变量 `gl_Position` 数据类型是四维向量 `vec4` ，可以用函数 `vec4()` 创建, `vec4()` 有四个参数，每个参数都是浮点数 `float`

+ `gl_Position` 的值,前面三个参数表示xyz坐标，第四个参数一般固定设置为1.0

  ```js
  const vertexShader = `
  void main(){
    gl_Position = vec4( x, y ,z ,1.0 );
  }
  `
  const material = new THREE.ShaderMaterial({
    vertexShader: vertexShader,// 顶点着色器
  });
  ```

+ 不过一般不会通过 `gl_Position` 直接写顶点坐标，而是从几何体 `BufferGeometry` 获取顶点坐标数据

  ```js
  const vertexShader = `
  void main(){
      gl_Position = vec4(从几何体获取顶点xyz坐标,1.0 );
  }
  `
  ```

## 着色器GLSL ES语言语法：attribute关键字

+ `attribute` 是着色器GLSL ES语言的一个关键字，按照GLSL ES的语法规定， `attribute` 关键字一般用来声明与顶点数据有关变量

+ `attribute vec3 pos;` 表示用 `attribute` 声明了一个变量 `pos` ， `attribute` 的作用就是指明 `pos` 是顶点相关变量， `pos` 的数类型是三维向量 `vec3` ，三维向量 `vec3` 意味着pos表示的顶点数据有x、y、z三个分量

  + 比如你可以用pos表示顶点的位置数据xyz(当然也能表示其它类型顶点数据)

  ```js
  const vertexShader = `
  attribute vec3 pos;//注意在主函数外面
  void main(){
    gl_Position = vec4(...,1.0 );
  }
  `
  const material = new THREE.ShaderMaterial({
    vertexShader: vertexShader,// 顶点着色器
  });
  ```

+ 假设 `attribute` 声明的变量 `pos` 表示顶点位置数据，你就可以赋值给 `gl_Position`

+ 执行 `vec4(pos,1.0 )` , 给三维向量vec3增加一个分量，就可以变成四维向量 `vec4` (这是GLSL ES基本语法)

  ```js
  const vertexShader = `
  attribute vec3 pos;
  void main(){
    gl_Position = vec4(pos,1.0 );
  }
  `
  ```

## ShaderMaterial的内置变量position

+ 调用shader材质 `ShaderMaterial` 的时候，threejs会在内部给你写的顶点着色器代码中，插入一行代码 `attribute vec3 position;`
+ 相当于帮你声明了一个变量 `position` ， `position` 表示顶点的位置数据

  ```js
  const vertexShader = `
  attribute vec3 position;//默认提供,不用自己写
  void main(){
    gl_Position = vec4(...,1.0 );
  }
  `
  const material = new THREE.ShaderMaterial({
    vertexShader: vertexShader,// 顶点着色器
  });
  ```

## 内置变量position含义

+ 几何体 `geometry` 与 `ShaderMaterial` 材质构成了一个 `mesh`
+ 也就是说材质 `ShaderMaterial` 关联了几何体 `geometry`

  ```js
  const geometry = new THREE.PlaneGeometry(100, 50);
  console.log('顶点位置数据',geometry.attributes.position);
  const material = new THREE.ShaderMaterial();
  const mesh = new THREE.Mesh(geometry, material);
  ```

+ 当你 `ShaderMaterial` 的时候，threejs会在内部把内置变量 `position` 与几何体的顶点位置数据 `geometry.attributes.position` 关联起来
+ 这意味着，你在顶点着色器代码中访问变量 `position` ，就相当于获取了几何体顶点位置数据 `geometry.attributes.position`

  ```js
  const vertexShader = `
  // attribute vec3 position;//默认提供,不用自己写
  void main(){
    gl_Position = vec4(...,1.0 );
  }
  `
  ```

+ 总而言之，你可以通过执行代码 `gl_Position = vec4(position,1.0);` ，把几何体的顶点位置数据 `geometry.attributes.position` 赋值给内置变量 `gl_Position`

  ```js
  const vertexShader = `
  // attribute vec3 position;//默认提供,不用自己写
  void main(){
    gl_Position = vec4(position,1.0 );
  }
  `
  const material = new THREE.ShaderMaterial({
    vertexShader: vertexShader,// 顶点着色器
  });
  ```
