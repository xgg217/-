# 基本使用

## cannon-es安装和引入

+ 在工程化开发的时候可以通过npm命令行安装cannon.js模块

  ```shell
  npm install --save cannon-es
  ```

  ```js
  // 某个API
  import {World, Vec3} from "cannon-es";

  // 全部API一次性引入
  import * as CANNON from "cannon-es";
  ```

+ 在.html文件中直接引入的cannon-es，实际开发，用上面npm安装方式引入即可

  ```html
  <script type="importmap">
    {
      "imports": {
        "cannon-es": "../cannon-es/dist/cannon-es.js"
      }
    }
  </script>

  <script type="module">
    import * as CANNON from 'cannon-es';
    // 测试是否引入成功
    console.log('CANNON', CANNON.World);

    import { World } from 'cannon-es';
    console.log('World', World);
  </script>
  ```

## 碰撞体Body

+ 通过 `CANNON.Body` 类，可以创建一个用于物体物理模拟计算，比如用 `Body` 表示一个球、一个箱子、一张桌子，你可以计算 `Body` 的位置、速度等物理量

+ 可以也把 `Body` 称为碰撞体collider

  ```js
  const body = new CANNON.Body();
  ```

## 设置Body的物理属性

+ 设置 `Body` 的一些物理属性，比如质量 `mass`

  ```js
  const body = new CANNON.Body({
    mass: 0.3, // 碰撞体质量0.3kg
  });
  ```

+ 设置物体body的位置，CannonJS的三维向量Vec3和threejs名称不同，不过使用方式相似

  ```js
  const body = new CANNON.Body({
    mass: 0.3,
    // 碰撞体的三维空间中位置
    position: new CANNON.Vec3(0, 100, 0)
  });
  ```

## 碰撞体Body几何形状

+ 第一次接触Body，你可以类比threejs的 `Mesh` 去联想记忆，网格模型表示一个物体，需要通过几何体Geometry定义Mesh的几何外形
+ 对于Body同样道理，你需要设置物体 `Body` 的几何形状

+ CannonJS定义几何体形状的API有很多种，比如比如长方体 `Box` 、球体 `Sphere` 等等

  ```js
  // 1m半径球体
  const bodyShape = new CANNON.Sphere(1);

  // 可以把Body称为碰撞体,用来模拟生活中的物体
  const body = new CANNON.Body({
    mass: 0.3,
    position: new CANNON.Vec3(0, 100, 0),
    shape: bodyShape,//碰撞体的几何体形状
  });
  ```

## CANNON.World创建一个物理世界

+ 通过 `CANNON.World` 类创建一个物理世界

  ```js
  // CANNON.World创建物理世界对象
  const world = new CANNON.World();
  ```

+ 定义物理世界的物理属性，比如设置重力加速度

+ 重力加速度的属性 `gravity` 类似body的位置，是一个三维向量 `Vec3`

+ 重力加速度x、y、z分量值，实际开发根据自己项目和坐标系设置即可，咱们假设小球所在的场景，y轴竖直向上，这样重力就速度就是y方向负方向

  ```js
  const world = new CANNON.World();

  // 设置物理世界重力加速度
  world.gravity.set(0, -9.8, 0); //单位：m/s²
  ```

## .addBody()把物体添加到物理世界

+ 物理球 `body` 添加到物理世界中，这样body就会受到物理世界加速度的影响 `World`

  ```js
  const world = new CANNON.World();
  world.addBody(body);
  ```

## world.step()物理世界更新计算

+ 最后不要忘记周期性执行 `world.step()` 方法`，world.step()` 方法第一个参数表示固定时间步长
+ 一般可以设置为 `1/60` 秒，用于近似计算

  ```js
  function render() {
    world.step(1/60);//更新物理计算
    requestAnimationFrame(render);
  }
  render()
  ```

  ```js
  //固定的时间步长1/60秒
  const fixedTimeStep = 1/60;
  function render() {
    world.step(fixedTimeStep);
  }
  ```

# 浏览器控制台查看计算结果

+ 你可以查看物体对象body的位置 `.position` 、速度 `.velocity` 属性

  ```js
  function render() {
    console.log('球位置', body.position);
    console.log('球速度', body.velocity);
    console.log('y方向球位置', body.position.y);
    world.step(1/60);//更新物理计算
    requestAnimationFrame(render);
  }
  ```

## 浏览器控制辅助开发

+ 除了查看文档，你还可以通过浏览器控制台，查看CannonJS某个类的属性或方法。

+ Body具有位置 `.position` 、重量 `.mass` 、几何形状 `.shapes `等属性

  ```js
  const body = new CANNON.Body();
  console.log('body', body);
  ```

  ```js
  const body = new CANNON.Body({
    mass: 0.3,
    position: new CANNON.Vec3(0, 100, 0),
    shape: new CANNON.Sphere(1),
  });
  ```

+ 比如 `body.position` 位置属性的属性值是三维向量Vec3，Vec3具有`x`、`y`、`z` 属性和 `set` 等多个方法

  ```js
  const body = new CANNON.Body();
  console.log('body.position', body.position);
  ```

## 语法总结：访问或设置Body属性

+ 通过函数选项设置body对象

  ```js
  const body = new CANNON.Body({
    mass: 0.3,
    position: new CANNON.Vec3(0, 100, 0),
    shape: new CANNON.Sphere(0.1),
  });
  ```

+ 部分属性也可以直接访问设置

  ```js
  const body = new CANNON.Body();
  body.mass = 0.3;
  body.position = new CANNON.Vec3(0, 100, 0);
  ```

+ body没有 `.shape` 属性，而是 `.shapes` 属性
+ Body类提供了方法 `.addShape()` 设置几何体，执行 `.addShape()` 方法会改变 `.shapes` 属性

  ```js
  const body = new CANNON.Body();
  body.addShape(new CANNON.Sphere(1));
  ```
