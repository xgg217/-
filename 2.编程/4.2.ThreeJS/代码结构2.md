# 结构方式2

## 示意图

+ 文件结构

  ```
  项目
    ├─scene
    │  ├─ model
    │  │   ├─ 手机.gltf            # gltf模型
    │  │   ├─ basecolor.png        # 纹理贴图
    │  │   ├─ metallic.png         # 纹理贴图
    │  │   ├─ normal.png           # 纹理贴图
    │  │   ├─ opacity.png          # 纹理贴图
    │  │   └─ roughness.png        # 纹理贴图
    │  ├─ index.js                 # 场景总文件
    │  └─ model.js                 # 外部模型（如加载gltf模型）
    ├─  index.html                    # 文件入口
    ├─  gui.js                        # GUI调试
    ├─ RendererCamera.js             # 渲染相机
    └─  RenderLoop.js                 # 渲染循环
  ```

+ index.htl

  ```html
  <body>
    <script type="module">
      import {renderer} from './RenderLoop.js'
      //Three.js渲染结果Canvas画布插入到body元素中
      document.body.appendChild(renderer.domElement);
    </script>
  </body>
  ```

+ gui.js 调试

  ```js
  // 引入dat.gui.js库
  import * as dat from '../../../dat.gui-master/build/dat.gui.module.js';
  import { mobilePhoneMesh } from './scene/model.js'//手机模型
  //引入光源对象
  import { ambient, directionalLight1, directionalLight2, helper1, helper2 } from './scene/index.js'

  /**
   * 创建三维场景的控制界面
   */
  //创建控件对象变量
  var guiControls = {
    envMapIntensity: 0.5,
    旋转: false,//产品模型是否旋转
    ambient: 0.9,//环境光强度
    平行光1强度: 0.8,
    平行光2强度: 0.8,
    // 平行光1坐标
    x1: 100,
    y1: 75,
    z1: 50,
    // 平行光2坐标
    x2: -100,
    y2: -75,
    z2: -50,
  };

  //关联空间数据创建交互界面
  var gui = new dat.GUI();//创建GUI对象
  // var folder = gui.addFolder('菜单');//添加文件夹
  //设置交互界面位置
  gui.domElement.style = 'position:absolute;top:0px;right:0px;width:600px;';
  // 材质.envMapIntensity属性值变化范围0.0~1.0
  var envMapIntensityGUI = gui.add(guiControls, 'envMapIntensity', 0.0, 1.0);//添加环境贴图影响因子菜单选项
  // 事件函数.onChange：当通过UI界面envMapIntensity改变的时候，同步改变材质属性.envMapIntensity
  envMapIntensityGUI.onChange(function (value) {
    mobilePhoneMesh.material.envMapIntensity = value;//设置环境贴图对模型表面影响程度
  });
  // 控制模型旋转
  gui.add(guiControls, '旋转');
  // 控制环境光强度  最大强度值可以先随便给一个比较大，然后看看效果，在缩小范围调整
  var ambientGUI = gui.add(guiControls, 'ambient', 0.0, 5.0);
  ambientGUI.onChange(function (value) {
    ambient.intensity = value;//改变环境光强度
  });
  // 平行光1强度
  var directionalLight1GUI = gui.add(guiControls, '平行光1强度', 0.0, 5.0);
  directionalLight1GUI.onChange(function (value) {
    directionalLight1.intensity = value;//改变平行光强度
  });
  // 平行光2强度
  var directionalLight2GUI = gui.add(guiControls, '平行光2强度', 0.0, 5.0);
  directionalLight2GUI.onChange(function (value) {
    directionalLight2.intensity = value;//改变平行光强度
  });
  // 平行光1位置
  var x1 = gui.add(guiControls, 'x1', -100, 100);
  var y1 = gui.add(guiControls, 'y1', -100, 100);
  var z1 = gui.add(guiControls, 'z1', -100, 100);
  x1.onChange(function (value) {
    directionalLight1.position.x = value;
    helper1.update()
  });
  y1.onChange(function (value) {
    directionalLight1.position.y = value;
    helper1.update()
  });
  z1.onChange(function (value) {
    directionalLight1.position.z = value;
    helper1.update()
  });
  // 平行光2位置
  var x2 = gui.add(guiControls, 'x2', -100,100);
  var y2 = gui.add(guiControls, 'y2', -100,100);
  var z2 = gui.add(guiControls, 'z2', -100,100);
  x2.onChange(function (value) {
    directionalLight2.position.x = value;
    helper2.update()
  });
  y2.onChange(function (value) {
    directionalLight2.position.y = value;
    helper2.update()
  });
  z2.onChange(function (value) {
    directionalLight2.position.z = value;
    helper2.update()
  });


  export { guiControls }
    ```


+ RenderLoop.js 渲染循环

  ```js
  import { scene } from './scene/index.js'//Three.js三维场景
  import { renderer, camera } from './RendererCamera.js'//渲染器对象和相机对象
  // import { model } from './scene/model.js'//手机模型
  import {guiControls}  from './gui.js'

  // 渲染循环
  function render() {
    // if(guiControls.旋转)model.rotateY(0.01);//手机绕y轴旋转
    if(guiControls.旋转)scene.rotateY(0.01);//三维场景绕y轴旋转
    renderer.render(scene, camera); //执行渲染操作
    requestAnimationFrame(render); //请求再次执行渲染函数render，渲染下一帧
    // console.log(camera.position);//通过相机控件OrbitControls旋转相机，选择一个合适场景渲染角度
  }
  render();

  export {renderer}
  ```


+ RendererCamera.js 渲染相机

  ```js
  // 引入Three.js
  import * as THREE from '../../../three.js-r125/build/three.module.js';
  // 引入Three.js扩展库
  import { OrbitControls } from '../../../three.js-r125/examples/jsm/controls/OrbitControls.js';

  // width和height用来设置Three.js输出Canvas画布尺寸，同时用来辅助设置相机渲染范围
  var width = window.innerWidth; //窗口文档显示区的宽度
  var height = window.innerHeight; //窗口文档显示区的高度

  /**
  * 透视投影相机设置
  */
  // 30:视场角度, width / height:Canvas画布宽高比, 1:近裁截面, 3000：远裁截面
  var camera = new THREE.PerspectiveCamera(30, width / height, 1, 3000);
  camera.position.set(292, 223, 185);//相机在Three.js三维坐标系中的位置
  camera.lookAt(0, 0, 0);//相机指向Three.js坐标系原点

  /**
  * 创建渲染器对象
  */
  var renderer = new THREE.WebGLRenderer({
      antialias: true, //开启锯齿
  });
  renderer.setPixelRatio(window.devicePixelRatio);//设置设备像素比率,防止Canvas画布输出模糊。
  renderer.setSize(width, height); //设置渲染区域尺寸
  // renderer.setClearColor(0xffffff, 1); //设置背景颜色
  // renderer.domElement表示Three.js渲染结果,也就是一个HTML元素(Canvas画布)
  // document.body.appendChild(renderer.domElement); //body元素中插入canvas对象

  //创建控件对象  控件可以监听鼠标的变化，改变相机对象的属性
  // 旋转：拖动鼠标左键
  // 缩放：滚动鼠标中键
  // 平移：拖动鼠标右键
  var controls = new OrbitControls(camera, renderer.domElement);

  // onresize 事件会在窗口被调整大小时发生
  window.onresize=function(){
    // 重置渲染器输出画布canvas尺寸
    renderer.setSize(window.innerWidth,window.innerHeight);
    // 全屏情况下：设置观察范围长宽比aspect为窗口宽高比
    camera.aspect = window.innerWidth/window.innerHeight;
    // 渲染器执行render方法的时候会读取相机对象的投影矩阵属性projectionMatrix
    // 但是不会每渲染一帧，就通过相机的属性计算投影矩阵(节约计算资源)
    // 如果相机的一些属性发生了变化，需要执行updateProjectionMatrix ()方法更新相机的投影矩阵
    camera.updateProjectionMatrix ();
  };
  export { renderer, camera };
  ```

+ scene/index

  ```js
  // 场景总文件
  // 引入Three.js
  import * as THREE from '../../../../three.js-r125/build/three.module.js';
  import { model } from './model.js';
  /**
  * 创建场景对象Scene
  */
  var scene = new THREE.Scene();
  scene.add(model);//产品三维模型添加到场景中

  /**
  * 光源设置
  */
  // 平行光1
  var directionalLight = new THREE.DirectionalLight(0xffffff,0.8);
  directionalLight.position.set(400, 200, 300);
  scene.add(directionalLight);
  // 平行光2
  var directionalLight2 = new THREE.DirectionalLight(0xffffff, 0.8);
  directionalLight2.position.set(-400, -200, -300);
  scene.add(directionalLight2);
  //环境光
  var ambient = new THREE.AmbientLight(0xffffff, 0.9);
  scene.add(ambient);

  // Three.js三维坐标轴 三个坐标轴颜色RGB分别对应xyz轴
  var axesHelper = new THREE.AxesHelper(250);
  // scene.add(axesHelper);

  export { scene };
  ```

+ scene/model

  ```js
  // 引入Three.js
  import * as THREE from '../../../../three.js-r125/build/three.module.js';
  // 引入gltf模型加载库GLTFLoader.js
  import { GLTFLoader } from '../../../../three.js-r125/examples/jsm/loaders/GLTFLoader.js';

  var model = new THREE.Group();//声明一个组对象，用来添加加载成功的三维场景
  var loader = new GLTFLoader(); //创建一个GLTF加载器

  loader.load("./scene/model/手机.gltf", function (gltf) {//gltf加载成功后返回一个对象
    // 把gltf.scene中的所有模型添加到model组对象中
    model.add(gltf.scene);
  });

  export { model }
  ```

